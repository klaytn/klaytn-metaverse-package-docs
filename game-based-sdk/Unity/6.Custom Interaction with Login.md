## Custom Interaction with Login

In this section you will see how to build a Unity project with a login button to connect a web3 wallet and two other buttons to write and read the contract.

Start by creating a new project by following the steps at the section [Create a new Unity project]().

Make sure to install all dependencies to fix all bugs.

#### Use the WebLogin prefab to enable web3 wallet connection

Under **Assets** → **Web3Unity** → **Scenes**, double-click on **WebLogin**. This is the prefab used to connect a wallet in a WebGL project.
 
![image](https://user-images.githubusercontent.com/105277604/191379289-d3ee8fb5-d871-43ef-8477-11ccb9e0c9ac.png)

- Go to **File** → **Build Settings** → **WebG**L → **Switch Platform**
 
![image](https://user-images.githubusercontent.com/105277604/191379314-314636b9-c730-45a2-80cf-6108235b8586.png)


- From the same window, click on **Add Open Scenes** (top right) to add the Login scene as the first scene to appear when we run the project.

- From the same window, click on **Player Settings** → **Player** → **Resolution and Presentation**, under **WebGL Template**, select the one with the same as our Unity version (WebGL 2020 for our case).
 
![image](https://user-images.githubusercontent.com/105277604/191379335-b8082420-fc3e-46ac-aa97-29096e25cb60.png)

- Go back to the Unity project. Under **Assets**, select **Scenes** and double-click on **SampleScene** to use it as our second scene (FYI the first one is the login scene)

- Go to **File** → **Build Settings** → **Add Open Scenes**. The SampleScene will appear under the WebLogin scene. It means the SampleScene, where we will create the buttons to read and write to the contract, will be the next scene after the WebLogin.
:warning: Make sure the WebLogin scene is at the top because the order matters.
 
![image](https://user-images.githubusercontent.com/105277604/191379361-9ae0d72d-8888-49e9-85f3-477a6adad202.png)


#### Create your contract
- Open Remix IDE, install the Klaytn Remix plugin then paste the code below:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract Storage { 

    uint256 number;

    function store(uint256 num) public {
        number = num;
    }

    function retrieve() public view returns (uint256) {
        return number;
    }
}
```
- Compile your contract and deploy it to baobab testnet (get your faucet [here](https://baobab.wallet.klaytn.foundation/faucet)).

#### Create your C# script on Unity
- Under **Project** window, right-click on **Scenes**, click on **Create** → **C# Script**
 
![image](https://user-images.githubusercontent.com/105277604/191379397-733eecd1-c329-44ea-8b9f-23fc3a37e715.png)

- Rename it (here we’ll use the name “CallABI”)
 
![image](https://user-images.githubusercontent.com/105277604/191379430-b8c49086-2c6d-4a25-8535-34924379582a.png)

- Double-click on the script to open it. Complete the script with the information below 

```C++
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using System;

public class CustomCallABIExample : MonoBehaviour
{

    // set chain
    string chain = "klaytn";
    // set network
    string network = "testnet";
    // set contract address
    private string contract = "0xDf5A1aAa8C1E6a7b4e42dA606Ed8e43BeF764D13";
    // set contract ABI
    private readonly string abi = "[{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"num\",\"type\":\"uint256\"}],\"name\":\"store\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"signature\":\"0x6057361d\"},{\"inputs\":[],\"name\":\"retrieve\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\",\"constant\":true,\"signature\":\"0x2e64cec1\"}]";
    // set RPC endpoint url
    string rpc = "https://public-node-api.klaytnapi.com/v1/baobab";

    // Call the "store" function with "10" as argument
    async public void AddValue()
    {
        // contract function 
        string method = "store";
        // argument
        string args = "[\"10\"]";
        // value in ston (wei) in a transaction
        string value = "0";
        // gas limit (OPTIONAL)
        string gasLimit = "";
        // gas price (OPTIONAL)
        string gasPrice = "";

        try 
        {
            string response = await Web3GL.SendContract(method, abi, contract, args, value, gasLimit, gasPrice);
            Debug.Log(response);
        } catch(Exception e) 
        {
            Debug.LogException(e, this);
        }
    }

    // Call the retrieve function
    async public void GetValue()
    {
        // contract function
        string method = "retrieve";
        // arguments
        string args = "[]";
        try
        {
            string response = await EVM.Call(chain, network, contract, abi, method, args, rpc);
            Debug.Log(response);
        } catch(Exception e) 
        {
            Debug.LogException(e, this);
        }
    }
}

```

#### Create the buttons
- Right-click on the scene, click on UI → Button and rename it to AddValue and RetrieveValue
 
![image](https://user-images.githubusercontent.com/105277604/191379461-0bf06078-cf18-491f-ab6f-a64175f669c5.png)

To interact with the buttons:

1. Click on **AddValue** button from the Hierarchy window

2. Drag the CallABI script into the right window

3. Add an **On Click()** function by clicking on the :heavy_plus_sign: button
 
![image](https://user-images.githubusercontent.com/105277604/191379499-d45aba81-8acf-4025-a3b4-669ecd9caabf.png)

4. Drag the **AddValue** button from Hierarchy window into the On Click() function

5. Click on **No Function** → **CallABI** → **AddValue()**
 
![image](https://user-images.githubusercontent.com/105277604/191379515-10051c34-35f0-4468-be24-30a1b92a97bf.png)

- For the RetrieveValue button, redo the steps from step 1 to step 5 above, but instead of selecting AddValue, select **RetrieveValue**

Edit the network chainID under **Assets** → **WebGLTemplates** → **Web3GL-2020x** → **network.js**.
Set the ```window.web3ChainId``` to ```1001```.
 
![image](https://user-images.githubusercontent.com/105277604/191379560-97ad1a8c-e7c1-4740-aeb6-5caa5a5ba736.png)

To test the **Retrieve Value** function, click on play :arrow_forward: and click on Retrieve Value
 
![image](https://user-images.githubusercontent.com/105277604/191379579-1b46a094-521d-4246-9e06-fa7162d5f2fe.png)

- To test the Add Value function , click **File** → **Build and Run**. You will have a new window in the browser that will show you the login interface
 
![image](https://user-images.githubusercontent.com/105277604/191379595-34c8600e-1aa2-4589-9ae8-894a3c32d942.png)

- Click on **Login** to connect to Metamask

- Click on **Add Value** to add the value of 10 to the contract

- Confirm your transaction on Metamask and voilà ! Your transaction is sent to the network.
 
![image](https://user-images.githubusercontent.com/105277604/191379628-9a56762c-292a-44f6-9386-d423edb25a38.png)
